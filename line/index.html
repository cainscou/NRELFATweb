<!DOCTYPE html>
<html lang="en-US">
<head>

<meta charset="UTF-8" />
<title>dc test - NREL Line Graph Sample</title>

<meta name="keywords" content="Hydrogen, Fuel Cell, Fuel Cells, National Renewable
    Energy Lab, NREL, U.S. Department of Energy, DOE, Renewable Energy,
	Research, Technology Validation, Charts, Graphs" />
<meta name="description" content="NREL Interactive Web Graphics Template" />
<meta name="author" content="U.S. Department of Energy, National Renewable Energy Lab" />

<!-- Helps compatibility with IE 8 and earlier -->
<!--[if lt IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.js"></script>
<![endif

<!-- STYLESHEETS -->
<link rel="stylesheet" type="text/css" href="http://www.nrel.gov/includes/nrel.css" />
<link rel="stylesheet" type="text/css" href="dc.css" />

<!-- Local Styles for this WebPage -->
<style>


noscript {
  font-size:150%;
  color:red;
  margin:30px;
}

</style>

</head>  
<body>

<!-- WEBPAGE HTML AND TEXT INFORMATION -->
<!-- Information displayed above the charts -->
<h2>Number of Stations Constructed per year</h2>

<p>This graph represents the number of Hydrogen Fuelling stations constructed across the country</p>

<p><b>Instructions for Interactive Graphics:</b> <br /> <i> Click and drag on the lower graph to select the data range for the upper graph. <br /> This allows you to apply your own custom data filters and criteria!</i></p>

<!-- Additional spacing between text and graph -->
<p> <br /> <br /> </p>

<!-- Added this section in case JavaScript is not enabled on users web browser -->
<noscript><br />Sorry, JavaScript is either not enabled, or is not supported by your web browser.  <br />
		  Scripts must be enabled to see the interactive data visualizations on this page. <hr /> </noscript>
			   
<!-- DC CHART LOCATION - DC APPENDS CHART ELEMENTS INTO THESE DIVS -->
<div id="lineChart"></div>
<div id="barChart"></div>


<!-- WEBAGE JAVASCRIPT LIBRARIES -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="crossfilter.js"></script>
<script type="text/javascript" src="d3.js"></script>
<script type="text/javascript" src="dc.js"></script>

<!-- Main WebPage Script -->
<script>

// Put graphing script into function call to limit variable scopes.
(function() {

// AJAX CALL FOR DATA DOWNLOAD, AND ADDING DATA INTO THE CHART:
// While the data is downloading, the next block of code after the d3.csv command will 
// execute.  Then, when all data has downloaded, the code inside the function passed 
// as an argument to d3.csv will execute.
d3.csv("cdp8_modifiedHeaders.csv", type, function(error, data) {

  // Defines some error handling if data file can not be loaded.
  if (error) { 
    d3.select("#charts").append("p").append("b")
    .text("The data file to produce interactive graphics could not be loaded."); 
    throw error;
  }
  
	// set up crossfilters
	var crossfilterData = crossfilter(data);

	/*
	var all = crossfilterData.groupAll();
	var costPerKwNI = crossfilterData.dimension( function (d) { return d.cost_per_kW_NI; } );
	var costPerKwNI_sumByYear = year.group().reduceSum(function (d) { return d.cost_per_kW_NI; } );
	var costPerKwIncentive_sumByYear = year.group().reduceSum(function (d) { return d.cost_per_kW_Incentive; } );
	*/
	
	// Define Line Chart
	var year = crossfilterData.dimension( function (d) { return d.year; });
	var minDate = new Date(2002, 00, 01);
	var maxDate = new Date(2014, 00, 01);
	var dataPointsPerYear = year.group().reduceCount();
	var line1 = dc.lineChart("#lineChart")
					.dimension(year)
					.colors('red')
					.group(dataPointsPerYear, "Number of Stations Constructed")
					.width(width)
					.height(height)
					.x(d3.time.scale().domain([minDate,maxDate]))
					.yAxisLabel("Number of Stations Constructed")
					.xAxisLabel("Year")
					.legend(dc.legend().x(80).y(20).itemHeight(13).gap(5))
					.renderHorizontalGridLines(true);
	/* var line2 = dc.lineChart(lineComposite)
					.dimension(year)
					.colors('blue')
					.group(costPerKwIncentive_sumByYear, "With Incentive");  */	
	
	
	// Define Bar Chart
	var binSize = 500;
	var minCapacity = 0;
	var maxCapacity = 5000;
	var capacity = crossfilterData.dimension( function (d) { return d.capacity_kW; } );
	var capacityCountByBinsize = capacity.group( function(d) { return Math.floor(d/binSize)*binSize; } );
	var bar1 = 	dc.barChart("#barChart")
					.width(width)
					.height(height)
					.x(d3.scale.linear().domain([minCapacity, maxCapacity]))
					.dimension(capacity)
					.group(capacityCountByBinsize)
					.xUnits(dc.units.fp.precision(binSize))
					.yAxisLabel("Number of Stations Constructed")
					.xAxisLabel("Capacity (kW)");

	
	// Render Everything
	line1; bar1; dc.renderAll();

}); // end of d3.csv asynchronous call


// THIS SECTION INITIALIZES VARIABLES THAT DEFINE THE CHART:
// This runs immediately after the data download in d3.csv begins, 
// and before any code within the d3.csv asynchronous call begins.

// Defines chart dimensions
var margin = {top: 10, right: 150, bottom: 135, left: 70},
    margin2 = {top: 430, right: 150, bottom: 60, left: 70},
    width = 750 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom,
    height2 = 540 - margin2.top - margin2.bottom;

// Defines function to convert timestamps into JavaScript date format
var parseDate = d3.time.format("%Y").parse;
	

// SUB-FUNCTION DEFINITIONS:

// This function executes when data is initially loaded to 
// convert the variable data types from strings.
function type(d) {
  d.year = parseDate(d.year);
  d.cost_per_kW_NI = +d.cost_per_kW_NI;
  d.cost_per_kW_Incentive = +d.cost_per_kW_Incentive;
  d.capacity_kW = +d.capacity_kW;
  d.Cost_dollars = +d.Cost_dollars;
  d.Cost_dollars_with_incentive = +d.Cost_dollars_with_incentive;
  return d;
}


})()// END OF MAIN WEBPAGE SCRIPT and NRELWebFat_Line Function Call

</script>

</body>
</html>
